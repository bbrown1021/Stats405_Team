---
title: "Spotify Clarifies"
subtitle: "An Analysis of Music Popularity over Time"
author: 
- Britney Brown, Harrison DiStefano, Greg Eastman
- Lisa Kaunitz, Tianyang Liu, Jeremy Weidner
date: "06/09/2021"
geometry: 'left=12mm, right=12mm, top=15mm, bottom=15mm'
fontsize: 12pt
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex:  true
    toc: no
    toc_depth: '3'
header-includes:
 \usepackage{indentfirst}
 \usepackage{background}
 \usepackage{float}
 \backgroundsetup{
 scale=1,
 color=black,
 angle=0,
 pages=all,
 contents={\includegraphics[width=22cm,height=52cm]{music_graphic.jpg}}
 }
indent: true
---

\vspace{8pt}

Music has been an integral part of our culture since well before the invention of the computer. Lately we have seen digital music take the industry by storm, which for the first time in musical history gives us the ability to analyze the quantifiable components of the music we all enjoy. Popular music has evolved significantly over the last fifty years from songs like the Beatles' "I Want to Hold Your Hand" to Taylor Swift's "Shake it Off." Although we recognize a shift here, what can the data behind these songs tell us about trends in the music industry?

\vspace{12pt}

## Key Insights

Through our analysis of musical attributes, we found four interesting results:

- We discovered two important themes that span across all time: emotions and relationships. Regardless of societal evolution, the want to express our emotions towards the people we care for is a constant force. 

- We also found that people tend to prefer sad, depressing songs more in the recent years due to a decrease in valence (positive sounds) and increase in minor modes. A quick scan of current events probably makes this one of our less surprising findings.

- In order for a song to be considered "danceable", there should be some acoustic presence, high valence, a slightly above average loudness, and an avoidencess of too much instrumentalness. 

- In the last 20 years, tracks have consistently maintained approximately nine sections. This steady approach to song structure highly suggests the introduction of a breakthrough algorithmic approach towards song creation in order to increase success potential. 

\newpage

## Song Titles

A text mining analysis of song titles revealed the importance of the term "love". This lead us to explore the prevalence of emotions in song titles as well as the people mentioned, such as "baby," "boy," and "girl". These descriptions of who these people are to the artists of each song revealed that regardless of time, music will forever be used to express our feelings towards the people that mean the most to us. 

\vspace{4pt}

## Musical Attributes 

Using data from Spotify's Web API, we analyzed song construction to better understand what makes particular songs timeless and others forgettable. We looked at the overall trends in music theory variables such as tempo, time signature, and key signature as well as attributes defined by Spotify such as danceability, acousticness, loudness, instrumentalness, and valence. These results revealed patterns that were constant in hit tracks over the span of six decades as well as those that indicate a change in our listening preferences over time. We dove even further into our analysis through the decades by comparing song duration and major and minor mode percentages, further verifying our results in the evolution of music preference. 

```{r connect to database, echo=FALSE, eval=TRUE, results='hide', warning = FALSE, message = FALSE}

# Libraries
library(RMySQL)
library(knitr)
library(xtable)
library(kableExtra)
library(plotly)
library(RMariaDB)
library(DBI)
library(ggplot2)
library(dplyr)
library(reshape2)
library(stringr)
library(tm)
library(wordcloud2)
library(tidytext)
library(htmlwidgets)
library(webshot)
webshot::install_phantomjs()


# Constants
DECADE_ORDER <- c("60s\r", "70s\r", "80s\r", "90s\r", "00s\r", "10s\r")

# Helper functions to get mode
getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}

options(xtable.comment = FALSE) #### prevents commenting when printing xtable latex

projpath <- getwd()

if(!exists("xdbsock")) {
    xdbsock <- ""
    cat("\n", 
        "Parameter 'xdbsock' not found, setting to empty string for general usage", 
        "\n")
}

drv <- dbDriver("MySQL") # create driver object

# connect to Jeremy's database
db_host <- Sys.getenv("db_read_endpoint")
db_user <- Sys.getenv("db_read_user")
db_pw   <- Sys.getenv("db_read_password")
db_port <- Sys.getenv("db_read_port")
db_name <- Sys.getenv("db_read_db")
db_drv  <- RMariaDB::MariaDB()

con <- dbConnect(db_drv, user=db_user, password=db_pw, dbname=db_name, host=db_host, port=db_port)

dbListTables(con) # see what tables we have 

dbGetInfo(con)

##### make dataDictionary JSON
# yy <- dbGetQuery(con, "SELECT * FROM dataDictionary")
# writeLines(yy[ 1, "variableDefs"], file.path("~", "Desktop", "DataDictionary.json"))

```

```{r echo=FALSE, eval=TRUE, results='hide', warning=FALSE, message = FALSE, fig.height = 4, fig.width = 6, fig.align="center"}
overview_query <- "
SELECT
  decade
  , danceability
  , energy
  , speechiness
  , acousticness
  , valence
FROM
  music
WHERE
  hit = '1'
"

overview_result <- dbGetQuery(con, overview_query)

avg_traits_by_decade <- overview_result %>%
  group_by(decade) %>%
  summarize_all("mean") %>%
  melt(id = "decade")

avg_traits_by_decade$`Musical Attribute` <- avg_traits_by_decade$variable

p <- ggplot(data = avg_traits_by_decade,
       aes(x = factor(decade, level = DECADE_ORDER),
           y = value, color = `Musical Attribute`)
       ) +
  geom_line(aes(group = `Musical Attribute`), size = 1) +
  geom_point() +
  xlab("Decade") +
  ylab("Value") +
  scale_y_continuous(limits = c(0, 1.0)) +
  theme(legend.title = element_blank(), plot.title = element_text(hjust = 0.5),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        legend.text=element_text(size=7)) +
  theme_minimal()

p + theme(axis.title.x = element_text(size = 10),
          axis.title.y = element_text(size = 10),
          legend.title = element_text(size = 10))

```

## Track Production

Finally, our goal to achieve a better interpretation of musical trends was not only achieved, but we also gained a greater understanding of the modern music world. A visual exploration of our section variables revealed that in the last 20 years, tracks have consistently maintained approximately nine sections including intro, verse 1, pre-chorus, chorus, verse 2, pre-chorus, chorus, bridge, and outro. We believe this indicates the introduction of a formulaic or even algorithmic approach to producing songs in recent years. Our analysis indicates a more constant, rigid structure in hit songs that the music industry utilizes to increase a track's potential to become a hit. A query of top artists over the years verified this intuition by demonstrating a shift in song production over the decades: artists in the 60s and 70s had a focus on larger outputs of songs while current arists are more focused on the quality of the songs shared with the public. 



